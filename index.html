<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Connect 4</title>
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.2/normalize.min.css">-->
    <link rel="stylesheet" href="local/normalize.min.css">
    <style type="text/css" media="all">
        #main {
            background-color: blue;
            width: 350px;
            overflow: hidden;
        }

        .item {
            border-radius: 55px;
            background-color: #fff;
            width: 40px;
            height: 40px;
            float: left;
            border: 5px solid blue;
        }

        .item.active {
        }

        .item.red {
            background-color: #ff0000;
        }

        .item.yellow {
            background-color: yellow;
        }

        .row-0 {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="main"></div>
<a href="#" class="reset-game">Reset Game</a>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"></script>-->

<script src="local/jquery.min.js"></script>
<script src="local/underscore-min.js"></script>
<script type="text/javascript" charset="utf-8">
    (function ( $ ) {
        var connectFour = {
            tableSize : [ 7, 6 ],
            lastMovedBy : false,
            currentPlayer : 'yellow',
            positions : [],

            init : function () {
                // Generate Game board
                this.generatePositions();
                this.buildGameBoard();
                $('.reset-game' ).on('click', function(e){
                    e.preventDefault();
                    connectFour.resetBoard();
                });
            },
            generatePositions : function () {

                for ( var i = 0; i < this.tableSize[ 1 ]; i++ ) {

                    this.positions[ i ] = [];

                    for ( var x = 0; x < this.tableSize[ 0 ]; x++ ) {
                        this.positions[ i ][ x ] = 0;
                    }
                }
            },
            buildGameBoard : function () {
                _( this.tableSize[ 1 ] ).times( function ( rowIndex ) {
                    _( connectFour.tableSize[ 0 ] ).times( function ( colIndex ) {
                        $( '#main' ).append( connectFour.createConnectCircle( colIndex, rowIndex ) );
                    } );
                } );
            },
            createConnectCircle : function ( colIndex, rowIndex ) {
                return $( '<div>' )
                        .addClass( 'item' )
                        .attr( 'data-col', colIndex )
                        .attr( 'data-row', rowIndex )
                        .bind( 'click', this.clickHandler );
            },
//            dropCircle : function ( colIndex ) {
//                this.lastMovedBy = this.currentPlayer;
//                this.currentPlayer = !this.currentPlayer;
//                var pos = 0; // start your way from here
//                $( '.item.col-' + colIndex + '.row-' + pos ).addClass( (this.currentPlayer ? 'yellow' : 'red') );
//                this.tryToGameOver( colIndex, pos );
//            },
//
//            tryToGameOver : function ( col, row ) {
//                this.checkHorizontal(col, row);
//                this.checkVertical(col, row);
//                this.checkDiagonal(col, row);
//            },
//
//            gameOver : function () {
//                var winner = (this.lastMovedBy) ? 'yellow' : 'red';
//                $('body' ).addClass('winner-' + winner);
//                console.log( 'Winner: ' + winner );
//            },
            clickHandler : function ( event ) {
                event.preventDefault();

                var col = $( this ).attr( 'data-col' );

                console.log(col);

                for(var i = connectFour.tableSize[1] -1; i >= 0; i--) {

                    var $slot = $('[data-col="' + col + '"][data-row="' + i + '"]' );

                    if(connectFour.positions[0][col] !== 0) {
                        console.log('invalid move');
                        break;
                    }
                    if(connectFour.positions[i][col] == 0) {
                        $slot.addClass(connectFour.currentPlayer);
                        connectFour.positions[i][col] = connectFour.currentPlayer;

                        connectFour.currentPlayer = connectFour.currentPlayer == 'yellow' ? 'red' : 'yellow';

                        console.log(i);
                        if(i == 0) {
                            connectFour.checkTie();
                        }

                        break;
                    }
                }
            },
            checkHorizontal : function ( col, row ) {

                console.log( 'check row ' + row );
                console.log( 'check row ' + row + 1 );
                console.log( 'check row ' + row + 2 );
                console.log( 'check row ' + row + 3 );
                console.log( 'check row ' + row + 4 );

            },
            checkVertical : function ( col, row ) {

                console.log( 'check col ' + col );
                console.log( 'check col ' + col + 1 );
                console.log( 'check col ' + col + 2 );
                console.log( 'check col ' + col + 3 );
                console.log( 'check col ' + col + 4 );

            },
            checkDiagonal : function ( col, row ) {
                console.log( 'check diagonal' );
                console.log( col, row );
                console.log( col + 1, row + 1 );
                console.log( col + 2, row + 2 );
                console.log( col + 3, row + 3 );
                console.log( col + 4, row + 4 );
            },
            checkTie: function() {

                var isTie = true;

                _(this.positions ).every(function(i) {
                    if(i.indexOf(0) > -1) {
                        isTie = false;
                        return;
                    }
                });

                if(isTie) {
                    $('body' ).addClass('tie-game');
                    this.resetBoard();
                }

            },
            resetBoard: function() {
                $( '#main' ).remove();
                $('<div id="main">' ).prependTo($('body'));
                connectFour.init();
            }
        };

        connectFour.init();

    })( jQuery );
</script>
</body>
</html>
